#!/bin/bash

ARCH=${ARCH:-$(dpkg-architecture -q DEB_BUILD_ARCH)}
DIST=${DIST:-$(lsb_release -cs)}

echo "Creating chroot for $(tput bold)$ARCH $DIST$(tput sgr0)..."
sleep 3

args=(
    --customize-hook='chroot "$1" update-ccache-symlinks'
    --include=aptitude,ca-certificates,ccache,eatmydata
    --mode=unshare
    --skip=output/dev
    --variant=buildd
)
ubuntu-distro-info --all | grep -qx $DIST && args+=(--components=main,universe)

mmdebstrap -v "${args[@]}" "$DIST" "/var/cache/sbuild/$DIST-$ARCH.tar.zst"
